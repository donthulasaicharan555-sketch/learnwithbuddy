<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LearnWithAI ‚Äî Student Companion (Single Page)</title>
<style>
/* ---------- VARIABLES & BASE ---------- */
:root{
  --bg1: linear-gradient(135deg,#a1c4fd,#c2e9fb);
  --bg2: linear-gradient(135deg,#f6d365,#fda085);
  --card:#ffffff;
  --muted:#6b7280;
  --accent:#4f46e5;
  --success: #10b981;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Poppins,Inter,Arial,sans-serif;background:var(--bg1);transition:background .35s,color .35s}
body.dark{ --card:#0b1220; --muted:#9aa4b2; background:linear-gradient(135deg,#0f1724,#081224); color:#e6eef8 }
.container{max-width:1100px;margin:28px auto;padding:0 18px}

/* NAV */
.nav{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-radius:14px;background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;box-shadow:0 8px 30px rgba(20,30,80,0.12)}
.brand{font-weight:700;font-size:1.15rem}
.nav-actions{display:flex;gap:10px;align-items:center}
.nav-btn{background:transparent;border:1px solid rgba(255,255,255,0.15);color:white;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600}
.nav-btn:hover{transform:translateY(-2px)}

/* HERO */
.hero{display:flex;gap:24px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:18px}
.intro{flex:1;min-width:260px}
.intro h1{margin:0;font-size:1.9rem}
.intro p{color:var(--muted);margin:8px 0 12px;max-width:640px;line-height:1.5}

/* GRID BOXES */
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:20px}
.card{position:relative;height:220px;border-radius:18px;background:var(--card);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px;text-align:center;cursor:pointer;overflow:hidden;box-shadow:0 10px 28px rgba(10,20,60,0.08);transition:transform .45s,box-shadow .35s}
.card:hover{transform:translateY(-10px) scale(1.04) rotate(0.8deg);box-shadow:0 26px 60px rgba(10,20,60,0.16)}
.card::before{content:"";position:absolute;inset:-120% -20% auto -20%;transform:rotate(12deg);transition:all .6s ease}
.card .icon{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;color:#fff;margin-bottom:8px;font-size:22px}
.c-blue{background:linear-gradient(135deg,#60a5fa,#3b82f6)}
.c-pink{background:linear-gradient(135deg,#f472b6,#fb7185)}
.c-green{background:linear-gradient(135deg,#34d399,#10b981)}
.c-purple{background:linear-gradient(135deg,#a78bfa,#7c3aed)}
.c-yellow{background:linear-gradient(135deg,#f59e0b,#f97316)}
.card h3{margin:6px 0 6px}
.card p{color:var(--muted);font-size:0.95rem}

/* SECTION PANELS */
.section{display:none;margin-top:22px;padding:18px;border-radius:12px;background:rgba(255,255,255,0.85);backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(10,20,60,0.06)}
body.dark .section{background:rgba(10,14,20,0.6)}
.section.active{display:block}
.section h2{margin-top:0}
.row{display:flex;gap:16px;flex-wrap:wrap}
.col{flex:1;min-width:260px}

/* QUIZ */
.quiz-area{display:flex;flex-direction:column;gap:12px}
.qtext{font-weight:700;margin-bottom:6px}
.opt{display:block;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);margin:6px 0;cursor:pointer;background:transparent}
.opt.selected{border-color:var(--accent);box-shadow:0 6px 20px rgba(79,70,229,0.12)}
.qcontrols{display:flex;gap:8px;align-items:center}

/* TEXT ANALYZER */
textarea{width:100%;min-height:110px;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);resize:vertical;background:transparent;color:inherit}

/* TOOLS */
.timer{display:flex;flex-direction:column;align-items:center;padding:14px}
.timer .time{font-size:2.6rem;font-weight:800}
.todo-list{max-height:240px;overflow:auto;padding:6px}

/* CHAT */
.chat{display:flex;flex-direction:column;height:420px;background:transparent;border-radius:10px}
.messages{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px}
.msg{max-width:78%;padding:10px 12px;border-radius:12px}
.msg.user{align-self:flex-end;background:linear-gradient(135deg,#60a5fa,#3b82f6);color:white}
.msg.bot{align-self:flex-start;background:rgba(0,0,0,0.05);color:inherit}

/* mood output small */
.mood-box{padding:10px;border-radius:8px;background:rgba(0,0,0,0.03);margin-top:8px}

/* small */
.small{font-size:0.9rem;color:var(--muted)}

/* responsive tweaks */
@media(max-width:820px){ .hero{flex-direction:column} .card{height:200px} }
</style>
</head>
<body>

<div class="nav">
  <div class="brand">LearnWithAI</div>
  <div class="nav-actions">
    <div style="display:flex;gap:8px">
      <button class="nav-btn" onclick="showHome()">Home</button>
      <button class="nav-btn" onclick="openSection('weakness')">Weakness</button>
      <button class="nav-btn" onclick="openSection('quiz')">Quiz</button>
      <button class="nav-btn" onclick="openSection('notes')">Notes</button>
      <button class="nav-btn" onclick="openSection('resources')">Resources</button>
      <button class="nav-btn" onclick="openSection('tools')">Tools</button>
      <button class="nav-btn" onclick="openSection('energy')">Energy</button>
      <button class="nav-btn" onclick="openSection('buddy')">Buddy</button>
      <button class="nav-btn" id="darkToggle" title="Toggle theme" onclick="toggleDark()">üåô</button>
    </div>
  </div>
</div>

<div class="container">
  <!-- HERO -->
  <div class="hero">
    <div class="intro">
      <h1>LearnWithAI ‚Äî Your adaptive student companion</h1>
      <p>Emotion-adaptive UI, smart quizzes, energy calculator, distraction alerts and an intelligent Buddy that helps you learn better. Click a tile below to open any tool.</p>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="nav-btn" onclick="openSection('quiz')">Start Quiz</button>
        <button class="nav-btn" onclick="openSection('weakness')">Analyze Weakness</button>
        <button class="nav-btn" onclick="openSection('buddy')">Ask Buddy</button>
      </div>
    </div>

    <div style="width:340px">
      <div style="background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 20px rgba(10,20,60,0.06)">
        <div style="font-weight:800">Profile</div>
        <div class="small">Hi buddy ü§ûyou're from first year rightüòé ‚Ä¢ CSE  ‚Ä¢ SR University</div>
        <hr style="margin:10px 0;border:none;border-top:1px solid rgba(0,0,0,0.06)">
        <div style="display:flex;justify-content:space-between">
          <div><div style="font-weight:700">Streak</div><div class="small">3 days</div></div>
          <div><div style="font-weight:700;color:var(--accent)">Focus</div><div class="small">Pomodoro ready</div></div>
        </div>
      </div>
    </div>
  </div>
  <div id="userDetails" style="
    background: rgba(151, 190, 165, 0.15);
    padding: 20px;
    border-radius: 12px;
    margin: 20px;
    backdrop-filter: blur(10px);
    color: white;
">
    <h2>Welcome, <span id="userName"></span> üëã</h2>
    <p><strong>College:</strong> <span id="userCollege"></span></p>
    <p><strong>Branch:</strong> <span id="userBranch"></span></p>
    <p><strong>Email:</strong> <span id="userEmail"></span></p>
</div>

  <!-- GRID CARDS -->
  <div class="grid" id="homeGrid">
    <div class="card" onclick="openSection('weakness')">
      <div class="icon c-blue">üí°</div>
      <h3>Weakness Detector</h3>
      <p class="small">Quiz + text analyzer that suggests targeted practice</p>
    </div>

    <div class="card" onclick="openSection('quiz')">
      <div class="icon c-purple">üß©</div>
      <h3>Adaptive Quiz</h3>
      <p class="small">Easy ‚Üí Medium ‚Üí Hard based on your performance</p>
    </div>

    <div class="card" onclick="openSection('notes')">
      <div class="icon c-green">üìò</div>
      <h3>Notes Organizer</h3>
      <p class="small">Save, tag & search notes (local)</p>
    </div>

    <div class="card" onclick="openSection('tools')">
      <div class="icon c-yellow">üß∞</div>
      <h3>Student Tools</h3>
      <p class="small">Pomodoro Timer, To-Do, Planner</p>
    </div>

    <div class="card" onclick="openSection('resources')">
      <div class="icon c-pink">üåê</div>
      <h3>Resources</h3>
      <p class="small">ChatGPT, Gemini, Canva + YouTube moods</p>
    </div>

    <div class="card" onclick="openSection('buddy')">
      <div class="icon c-blue">ü§ñ</div>
      <h3>Buddy (AI Mentor)</h3>
      <p class="small">Ask questions; buddy adapts to your mood</p>
    </div>
  </div>

  <!-- ------- SECTIONS ------- -->

  <!-- Weakness Detector -->
  <section id="weakness" class="section">
    <h2>Real-Time Weakness Detector</h2>
    <div class="row">
      <div class="col">
        <div class="quiz-area">
          <div style="font-weight:700">Quick Concept Quiz (3 Qs)</div>
          <div id="wd-q" class="qtext">Press Start to load questions</div>
          <div id="wd-opts"></div>
          <div class="qcontrols">
            <button onclick="wdPrev()">Prev</button>
            <button onclick="wdNext()">Next</button>
            <button onclick="wdFinish()" style="margin-left:auto;background:var(--success);color:white">Finish</button>
          </div>
          <div id="wd-feedback" class="small" style="margin-top:8px"></div>
        </div>
      </div>
      <div class="col">
        <div style="background:transparent;padding:12px;border-radius:10px">
          <h4>Text Analyzer</h4>
          <p class="small">Paste answers, notes or topic list and get suggestions</p>
          <textarea id="analyzer" placeholder="e.g. recursion, trees, pointers"></textarea>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button onclick="analyzeText()">Analyze</button>
            <button onclick="clearAnalyzer()">Clear</button>
          </div>
          <div id="analyzerRes" class="small" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:12px;background:var(--card);padding:12px;border-radius:10px">
          <h4>Suggestions</h4>
          <div id="wd-suggestions" class="small">Results & targeted suggestions appear here.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Quiz -->
  <section id="quiz" class="section">
    <h2>Adaptive Quiz</h2>
    <div class="row">
      <div class="col">
        <div class="quiz-area">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Level: <span id="quizLevel">Easy</span></div>
            <div class="small">Score: <span id="quizScore">0</span></div>
          </div>
          <div id="q-area">
            <div id="q-text" class="qtext">Press Start Quiz</div>
            <div id="q-options"></div>
          </div>
          <div class="qcontrols" style="margin-top:8px">
            <button onclick="prevQuestion()">Prev</button>
            <button onclick="nextQuestion()">Next</button>
            <button onclick="submitQuiz()" style="margin-left:auto;background:var(--accent);color:white">Submit</button>
          </div>
          <div id="quizFeedback" class="small" style="margin-top:8px"></div>
        </div>
      </div>
      <div class="col">
        <h4>How adaptive works</h4>
        <p class="small">Start at Easy. If you clear 70% you move to Medium. Clear Medium ‚Üí Hard. If accuracy drops, you move down.</p>
        <div style="margin-top:8px">
          <button onclick="startAdaptiveQuiz()">Start Adaptive Quiz</button>
          <button onclick="resetAdaptive()" style="margin-left:8px">Reset</button>
        </div>
        <div id="adaptiveLog" class="small" style="margin-top:10px"></div>
      </div>
    </div>
  </section>

  <!-- Notes -->
  <section id="notes" class="section">
    <h2>Notes Organizer</h2>
    <div class="row">
      <div class="col">
        <input id="noteTag" placeholder="Tag (subject)" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
        <textarea id="noteText" placeholder="Write note..." style="margin-top:8px"></textarea>
        <div style="margin-top:8px">
          <button onclick="saveNote()">Save Note</button>
          <button onclick="clearNotes()" style="margin-left:8px;background:#ef4444;color:white">Clear All</button>
        </div>
      </div>
      <div class="col">
        <h4>Saved Notes</h4>
        <div id="notesList" style="max-height:380px;overflow:auto"></div>
      </div>
    </div>
  </section>

  <!-- Resources -->
  <section id="resources" class="section">
    <h2>Resources & Mood Music</h2>
    <div class="row">
      <div class="col">
        <h4>Quick links</h4>
        <div style="display:flex;flex-direction:column;gap:8px">
          <a href="https://chat.openai.com" target="_blank">ChatGPT</a>
          <a href="https://gemini.google.com" target="_blank">Gemini</a>
          <a href="https://www.canva.com" target="_blank">Canva</a>
          <a href="https://www.linkedin.com" target="_blank">LinkedIn</a>
        </div>
      </div>
      <div class="col">
        <h4>YouTube by Mood</h4>
        <select id="mood" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
          <option value="">Select mood</option>
          <option value="motivating">Motivating</option>
          <option value="happy">Happy</option>
          <option value="calm">Calm/Focus</option>
          <option value="sleepy">Wake up</option>
        </select>
        <div style="margin-top:8px">
          <button onclick="openMood()">Open Playlist</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Tools -->
  <section id="tools" class="section">
    <h2>Student Tools</h2>
    <div class="row">
      <div class="col">
        <div class="timer">
          <h4>Pomodoro Timer</h4>
          <div class="time" id="timerDisplay">25:00</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button onclick="startTimer()">Start</button>
            <button onclick="pauseTimer()">Pause</button>
            <button onclick="resetTimer()">Reset</button>
          </div>
          <div class="small" style="margin-top:8px">Default: 25 min focus</div>
        </div>
      </div>

      <div class="col">
        <h4>To-Do List</h4>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <input id="taskInput" placeholder="New task..." style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
          <button onclick="addTask()">Add</button>
        </div>
        <div id="taskList" class="todo-list"></div>
      </div>

      <div class="col">
        <h4>Daily Planner</h4>
        <input type="date" id="planDate" style="padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)">
        <textarea id="planText" placeholder="Plan for date..." style="margin-top:8px"></textarea>
        <div style="margin-top:8px">
          <button onclick="savePlan()">Save Plan</button>
          <button onclick="showPlan()" style="margin-left:8px">Show Plan</button>
        </div>
        <div id="planList" class="small" style="margin-top:8px"></div>
      </div>
    </div>
  </section>

  <!-- Energy Calculator & Emotion -->
  <section id="energy" class="section">
    <h2>Smart Time-Energy Calculator & Emotion Mode</h2>
    <div class="row">
      <div class="col">
        <h4>Time-Energy Calculator</h4>
        <label>Hours slept: <input id="sleepH" type="number" min="0" max="24" value="7" style="width:70px"></label><br>
        <label>Meals today (1-3): <input id="meals" type="number" min="0" max="3" value="2" style="width:70px"></label><br>
        <label>Screen time (hours): <input id="screen" type="number" min="0" max="24" value="4" style="width:70px"></label><br>
        <label>Mood: 
          <select id="energyMood">
            <option value="neutral">Neutral</option>
            <option value="motivated">Motivated</option>
            <option value="tired">Tired</option>
            <option value="stressed">Stressed</option>
          </select>
        </label>
        <div style="margin-top:8px">
          <button onclick="calcEnergy()">Calculate Energy</button>
        </div>
        <div id="energyRes" style="margin-top:10px"></div>
      </div>

      <div class="col">
        <h4>Emotion Mode</h4>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button onclick="setMood('happy')">üòä Happy</button>
          <button onclick="setMood('stressed')">üòì Stressed</button>
          <button onclick="setMood('sad')">üò¢ Sad</button>
          <button onclick="setMood('angry')">üò° Angry</button>
          <button onclick="setMood('sleepy')">üò¥ Sleepy</button>
          <button onclick="setMood('confused')">üòï Confused</button>
        </div>

        <!-- Optional select controller for extra suggestions -->
        <div style="margin-top:12px">
          <label for="emotionSelect">Choose mood for suggestions: </label>
          <select id="emotionSelect" onchange="showMoodSuggestion()">
            <option value="">Select mood</option>
            <option value="stressed">Stressed</option>
            <option value="sad">Sad</option>
            <option value="angry">Angry</option>
            <option value="confused">Confused</option>
            <option value="overthinking">Overthinking</option>
            <option value="bored">Bored</option>
          </select>
          <div id="emotionOutput" class="mood-box">Select a mood to see suggestions</div>
        </div>

        <div id="moodNote" class="small" style="margin-top:10px">Current mood: <span id="currentMood">neutral</span></div>
      </div>
    </div>
  </section>

  <!-- Buddy -->
  <section id="buddy" class="section">
    <h2>Buddy ‚Äî Your AI Mentor</h2>
      <div class="messages" id="messages">
        <div class="msg bot">Hi! I'm Buddy ‚Äî ask me concepts, study plans or help (e.g., "Explain recursion", "Plan 2 hours").</div>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="chatInput" placeholder="Type question & press Enter" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(0, 0, 0, 0.06)">
        <button onclick="sendChat()">Send</button>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <div style="height:28px"></div>
  <footer style="text-align:center;color:var(--muted)">¬© 2025 LearnWithAI ‚Äî D. Saicharan ‚Ä¢ SR University</footer>
</div>

<script>
/* ----------------- Core Navigation & Theme ----------------- */
function hideAllSections(){
  document.querySelectorAll('.section').forEach(s=> s.classList.remove('active'));
}
function openSection(id){
  // hide home grid
  document.getElementById('homeGrid').style.display = 'none';
  hideAllSections();
  const el = document.getElementById(id);
  if(el) el.classList.add('active');
  else console.error('Section not found:', id);
  window.scrollTo({top:0,behavior:'smooth'});
}
function showHome(){
  hideAllSections();
  document.getElementById('homeGrid').style.display = 'grid';
  window.scrollTo({top:0,behavior:'smooth'});
}
function toggleDark(){
  document.body.classList.toggle('dark');
  localStorage.setItem('lw_theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}
if(localStorage.getItem('lw_theme') === 'dark') document.body.classList.add('dark');

/* ----------------- Weakness Detector ----------------- */
const wdQuestions = [
  {q:"What is the time complexity of binary search?", opts:["O(n)","O(log n)","O(n^2)"], a:1, topic:"Algorithms"},
  {q:"Which uses FIFO?", opts:["Stack","Queue","Tree"], a:1, topic:"Data Structures"},
  {q:"What does HTML stand for?", opts:["Hyper Text Markup Language","High Tool ML","Home Tool ML"], a:0, topic:"Web"}
];
let wd_i=0, wd_ans=[];
function renderWd(){
  const q=document.getElementById('wd-q'); const opts=document.getElementById('wd-opts'); opts.innerHTML='';
  q.textContent = `${wd_i+1}. ${wdQuestions[wd_i].q}`;
  wdQuestions[wd_i].opts.forEach((o,idx)=>{
    const b=document.createElement('button'); b.className='opt'; b.textContent=o;
    b.onclick=()=>{ document.querySelectorAll('#wd-opts .opt').forEach(x=>x.classList.remove('selected')); b.classList.add('selected'); wd_ans[wd_i]=idx; };
    opts.appendChild(b);
  });
}
function wdPrev(){ if(wd_i>0){ wd_i--; renderWd(); } }
function wdNext(){ if(wd_i < wdQuestions.length-1){ wd_i++; renderWd(); } }
function wdFinish(){
  let score=0; let topics={};
  wdQuestions.forEach((q,idx)=>{ if(wd_ans[idx]===q.a) score++; else topics[q.topic]=(topics[q.topic]||0)+1;});
  document.getElementById('wd-feedback').innerHTML = `Score ${score}/${wdQuestions.length}`;
  if(Object.keys(topics).length) showSuggestions(Object.keys(topics));
}
renderWd();

/* ----------------- Text Analyzer ----------------- */
const hints = {
  recursion: "Revise base case & draw recursion tree; practice fibonacci, factorial & simple recursions.",
  tree: "Practice traversals, recursion and iterative methods; solve problems on BFS/DFS.",
  pointers: "Practice pointer basics, null checks, pointer arithmetic & debugging small C programs.",
  graph: "Study BFS/DFS, shortest path algorithms & practice on small examples."
};
function analyzeText(){
  const txt = document.getElementById('analyzer').value.toLowerCase();
  if(!txt){ document.getElementById('analyzerRes').textContent='Paste something to analyze.'; return;}
  const found = Object.keys(hints).filter(k=>txt.includes(k));
  document.getElementById('analyzerRes').textContent = found.length? 'Found: ' + found.join(', '): 'No direct keywords found.';
  if(found.length) showSuggestions(found);
}
function clearAnalyzer(){ document.getElementById('analyzer').value=''; document.getElementById('analyzerRes').textContent=''; }

/* ----------------- Suggestions ----------------- */
function showSuggestions(topics){
  const box = document.getElementById('wd-suggestions'); box.innerHTML='';
  topics.forEach(t=>{
    const div=document.createElement('div'); div.style.marginBottom='8px';
    div.innerHTML = `<strong>${t}</strong>: ${hints[t] || 'Practice questions & review basics.'}`;
    box.appendChild(div);
  });
}

/* ----------------- Adaptive Quiz ----------------- */
const bank = {
  easy:[
    {q:"HTML stands for?", opts:["High Text Markup Language","Hyper Text Markup Language","Home Text ML"], a:1},
    {q:"Binary search complexity?", opts:["O(n)","O(log n)","O(n^2)"], a:1},
    {q:"Which is FIFO?", opts:["Stack","Queue","Tree"], a:1}
  ],
  medium:[
    {q:"Which sort is average-case O(n log n)?", opts:["Bubble","Quick","Selection"], a:1},
    {q:"JS keyword to declare constant?", opts:["var","let","const"], a:2}
  ],
  hard:[
    {q:"Which algorithm is stable?", opts:["Merge Sort","Quick Sort (in-place)","Heap Sort"], a:0},
    {q:"Normalization removes:", opts:["Redundancy","Speed","Memory"], a:0}
  ]
};
let adaptiveLevel='easy', adaptiveIndex=0, adaptiveAnswers=[], adaptiveScore=0, adaptiveQuestions=[];
function startAdaptiveQuiz(){
  adaptiveLevel='easy'; adaptiveIndex=0; adaptiveScore=0; adaptiveAnswers=[]; loadAdaptive();
  document.getElementById('adaptiveLog').textContent='Started at Easy';
}
function loadAdaptive(){
  adaptiveQuestions = JSON.parse(JSON.stringify(bank[adaptiveLevel]));
  adaptiveIndex=0; renderAdaptive();
}
function renderAdaptive(){
  document.getElementById('quizLevel').textContent = adaptiveLevel.charAt(0).toUpperCase()+adaptiveLevel.slice(1);
  document.getElementById('quizScore').textContent = adaptiveScore;
  const q = adaptiveQuestions[adaptiveIndex];
  document.getElementById('q-text').textContent = `Q${adaptiveIndex+1}. ${q.q}`;
  const opts = document.getElementById('q-options'); opts.innerHTML='';
  q.opts.forEach((o,i)=>{
    const b=document.createElement('button'); b.className='opt'; b.textContent=o;
    b.onclick=()=>{ document.querySelectorAll('#q-options .opt').forEach(x=>x.classList.remove('selected')); b.classList.add('selected'); adaptiveAnswers[adaptiveIndex]=i; };
    opts.appendChild(b);
  });
}
function nextQuestion(){ if(adaptiveIndex < adaptiveQuestions.length-1){ adaptiveIndex++; renderAdaptive(); } }
function prevQuestion(){ if(adaptiveIndex>0){ adaptiveIndex--; renderAdaptive(); } }
function submitQuiz(){
  // grade current set
  let score=0;
  adaptiveQuestions.forEach((q,idx)=>{ if(adaptiveAnswers[idx]===q.a) score++; });
  adaptiveScore = score;
  document.getElementById('quizFeedback').textContent = `You scored ${score}/${adaptiveQuestions.length} on ${adaptiveLevel}`;
  // adapt
  if(adaptiveLevel==='easy'){
    if(score >= Math.ceil(adaptiveQuestions.length*0.7)){
      adaptiveLevel='medium'; document.getElementById('adaptiveLog').textContent='Promoted to Medium'; loadAdaptive();
    } else { document.getElementById('adaptiveLog').textContent='Try Easy again or review basics'; }
  } else if(adaptiveLevel==='medium'){
    if(score >= Math.ceil(adaptiveQuestions.length*0.7)){
      adaptiveLevel='hard'; document.getElementById('adaptiveLog').textContent='Promoted to Hard'; loadAdaptive();
    } else { adaptiveLevel='easy'; document.getElementById('adaptiveLog').textContent='Dropped to Easy'; loadAdaptive(); }
  } else if(adaptiveLevel==='hard'){
    if(score >= Math.ceil(adaptiveQuestions.length*0.7)){
      document.getElementById('adaptiveLog').textContent='Excellent! You mastered Hard level.';
    } else { adaptiveLevel='medium'; document.getElementById('adaptiveLog').textContent='Dropped to Medium'; loadAdaptive(); }
  }
}
function resetAdaptive(){ adaptiveLevel='easy'; adaptiveScore=0; adaptiveAnswers=[]; document.getElementById('adaptiveLog').textContent='Reset'; document.getElementById('quizFeedback').textContent=''; document.getElementById('quizScore').textContent='0'; document.getElementById('quizLevel').textContent='Easy'; }

/* ----------------- Notes (localStorage) ----------------- */
function saveNote(){
  const tag=document.getElementById('noteTag').value.trim(), text=document.getElementById('noteText').value.trim();
  if(!tag||!text) return alert('Fill tag & note!');
  const notes = JSON.parse(localStorage.getItem('lw_notes')||'[]'); notes.unshift({tag,text,created:Date.now()});
  localStorage.setItem('lw_notes',JSON.stringify(notes)); document.getElementById('noteTag').value=''; document.getElementById('noteText').value=''; renderNotes();
}
function renderNotes(){
  const list=document.getElementById('notesList'); list.innerHTML=''; const notes=JSON.parse(localStorage.getItem('lw_notes')||'[]');
  if(!notes.length){ list.innerHTML='<div class="small">No notes yet</div>'; return; }
  notes.forEach(n=>{ const d=document.createElement('div'); d.className='note'; d.style.padding='10px'; d.style.marginBottom='8px'; d.style.borderRadius='8px';
    d.innerHTML=`<div style="font-weight:700">${n.tag}<span class="small" style="float:right">${new Date(n.created).toLocaleString()}</span></div><div class="small" style="margin-top:6px">${n.text}</div>`; list.appendChild(d);
  });
}
function clearNotes(){ if(confirm('Clear notes?')){ localStorage.removeItem('lw_notes'); renderNotes(); } }
renderNotes();

/* ----------------- Pomodoro Timer ----------------- */
let timer=null, timeLeft=25*60, running=false;
function formatTime(s){const m=Math.floor(s/60), sec=s%60; return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}` }
document.getElementById('timerDisplay').textContent = formatTime(timeLeft);
function startTimer(){ if(running) return; running=true; timer=setInterval(()=>{ if(timeLeft<=0){ clearInterval(timer); running=false; alert('Pomodoro done!'); timeLeft=25*60; document.getElementById('timerDisplay').textContent=formatTime(timeLeft); return; } timeLeft--; document.getElementById('timerDisplay').textContent=formatTime(timeLeft); },1000); }
function pauseTimer(){ if(timer) clearInterval(timer); running=false; }
function resetTimer(){ if(timer) clearInterval(timer); running=false; timeLeft=25*60; document.getElementById('timerDisplay').textContent=formatTime(timeLeft); }

/* ----------------- To-Do List ----------------- */
function addTask(){ const v=document.getElementById('taskInput').value.trim(); if(!v) return; const tasks=JSON.parse(localStorage.getItem('lw_tasks')||'[]'); tasks.unshift({id:Date.now(),text:v,done:false}); localStorage.setItem('lw_tasks',JSON.stringify(tasks)); document.getElementById('taskInput').value=''; renderTasks();}
function renderTasks(){ const box=document.getElementById('taskList'); box.innerHTML=''; const tasks=JSON.parse(localStorage.getItem('lw_tasks')||'[]'); if(!tasks.length) {box.innerHTML='<div class="small">No tasks</div>'; return;} tasks.forEach(t=>{ const d=document.createElement('div'); d.className='task'; d.style.display='flex'; d.style.justifyContent='space-between'; d.style.alignItems='center'; d.style.padding='8px'; d.style.borderRadius='8px'; d.style.marginBottom='6px'; d.innerHTML=`<div><input type="checkbox" ${t.done?'checked':''} onchange="toggleTask(${t.id})"> <span style="margin-left:8px">${t.text}</span></div><div><button onclick="deleteTask(${t.id})">Del</button></div>`; box.appendChild(d); });}
function toggleTask(id){ const tasks=JSON.parse(localStorage.getItem('lw_tasks')||'[]'); tasks.forEach(t=>{ if(t.id===id) t.done=!t.done; }); localStorage.setItem('lw_tasks',JSON.stringify(tasks)); renderTasks();}
function deleteTask(id){ let tasks=JSON.parse(localStorage.getItem('lw_tasks')||'[]'); tasks=tasks.filter(t=>t.id!==id); localStorage.setItem('lw_tasks',JSON.stringify(tasks)); renderTasks();}
renderTasks();

/* ----------------- Planner ----------------- */
function savePlan(){ const d=document.getElementById('planDate').value, text=document.getElementById('planText').value.trim(); if(!d||!text) return alert('Select date & enter plan'); const plans=JSON.parse(localStorage.getItem('lw_plans')||'{}'); plans[d]=text; localStorage.setItem('lw_plans',JSON.stringify(plans)); document.getElementById('planText').value=''; alert('Saved'); }
function showPlan(){ const d=document.getElementById('planDate').value; const plans=JSON.parse(localStorage.getItem('lw_plans')||'{}'); document.getElementById('planList').textContent = plans[d] || 'No plan for this date'; }

/* ----------------- Mood & Energy ----------------- */
function calcEnergy(){
  const sleep=Number(document.getElementById('sleepH').value||0), meals=Number(document.getElementById('meals').value||0), screen=Number(document.getElementById('screen').value||0), mood=document.getElementById('energyMood').value;
  let score = Math.max(0, Math.min(100, Math.round((sleep/8)*40 + (meals/3)*30 - (screen/8)*20 + (mood==='motivated'?10:0))));
  const rec = score>75? 'Deep focus (2x pomodoros)' : score>50 ? 'Normal study (1 pomodoro blocks)' : 'Light revision or short tasks (micro sessions)';
  document.getElementById('energyRes').innerHTML = `Energy: <strong>${score}/100</strong><br>Recommendation: ${rec}`;
}

/* ----------------- Mood (Emotion Mode): adapt UI & Buddy tone ----------------- */
let currentMood='neutral';
function setMood(m){
  currentMood=m; document.getElementById('currentMood').textContent=m;
  if(m==='stressed'){ document.body.style.filter='saturate(.9)'; alert('Take a 2-min breathing break.'); }
  else if(m==='happy'){ document.body.style.filter=''; }
  else if(m==='sad'){ document.body.style.filter='grayscale(.06)'; }
  else if(m==='sleepy'){ document.body.style.filter='brightness(1.06)'; }
  else document.body.style.filter='';
  localStorage.setItem('lw_mood',m);
}
if(localStorage.getItem('lw_mood')){ currentMood = localStorage.getItem('lw_mood'); document.getElementById('currentMood').textContent=currentMood; }

/* ----------------- YouTube Mood ----------------- */
function openMood(){
  const m=document.getElementById('mood').value; if(!m) return alert('Choose mood');
  const map={motivating:'motivational+study+music',happy:'happy+study+songs',calm:'calm+study+music',sleepy:'wake+up+music'};
  window.open('https://www.youtube.com/results?search_query='+map[m],'_blank');
}

/* ----------------- Buddy Chat ----------------- */
const messages = document.getElementById('messages');
function appendMessage(who,text){
  const d=document.createElement('div'); d.className='msg ' + (who==='user'?'user':'bot'); d.innerHTML = text.replace(/\n/g,'<br>');
  messages.appendChild(d); messages.scrollTop = messages.scrollHeight;
}
function sendChat(){
  const input = document.getElementById('chatInput'); const tx=input.value.trim(); if(!tx) return;
  appendMessage('user', tx); input.value='';
  appendMessage('bot', 'Buddy is thinking...');
  setTimeout(()=>{ const botMsgs = messages.querySelectorAll('.msg.bot'); if(botMsgs.length) botMsgs[botMsgs.length-1].remove(); const reply = generateBuddyReply(tx.toLowerCase()); appendMessage('bot', reply); }, 700 + Math.random()*700);
}
function generateBuddyReply(msg){
  let prefix='';
  if(currentMood==='stressed') prefix = "I can help calm down first ‚Äî try breathing for 1 minute. Then: ";
  else if(currentMood==='sad') prefix = "I got you ‚Äî small steps help. Here's a tip: ";
  else if(currentMood==='happy') prefix = "Nice! Keep the momentum. Also: ";
  else if(currentMood==='sleepy') prefix = "You're sleepy ‚Äî try a short active break, then: ";
  else if(currentMood==='confused') prefix = "Let's simplify it step-by-step: ";

  if(msg.includes('recursion')) return prefix + "- Recursion: identify base case and recursive relation. Dry-run with a small input. Example: factorial(n) = n * factorial(n-1).";
  if(msg.includes('binary search') || msg.includes('binary')) return prefix + "- Binary search requires a sorted array. Each step halves the search range ‚Üí O(log n).";
  if(msg.includes('queue') || msg.includes('fifo')) return prefix + "- Queue works FIFO: enqueue at rear, dequeue at front. Useful in BFS and scheduling.";
  if(msg.includes('how to study') || msg.includes('study tips')) return prefix + "- Study tip: Use Pomodoro (25/5), active recall, spaced repetition, and teach someone what you learned.";
  if(msg.includes('plan') && msg.includes('hour')) return prefix + "- For 2 hours: 4 x 25-min focused sessions interleaved with 5-min breaks; tough topic first.";
  if(msg.includes('explain') && msg.includes('tree')) return prefix + "- Trees: hierarchical nodes. Root ‚Üí children. Traversals: inorder/preorder/postorder for binary trees.";
  if(msg.includes('python')) return prefix + "- Python tip: start with variables, loops, functions. Practice small projects like a calculator or to-do CLI.";
  if(msg.includes('motivate') || msg.includes('stuck')) return prefix + "- Feeling stuck? Break problem into sub-parts. Solve a simpler version first. Small wins add up.";
  if(msg.includes('energy') || msg.includes('tired')) return prefix + "- Energy tip: check sleep and food. Short walk and water often helps cognitive performance.";
  return prefix + "I can help with that ‚Äî try asking specifically (e.g., 'Explain recursion', 'Plan 2 hours', or paste code/snippets).";
}

/* ----------------- Idle / Distraction Alert ----------------- */
let idleSeconds = 0;
const IDLE_LIMIT = 60; // seconds
function resetIdle(){ idleSeconds = 0; }
['mousemove','keydown','mousedown','touchstart','scroll'].forEach(ev => document.addEventListener(ev, resetIdle));
setInterval(()=>{ idleSeconds++; if(idleSeconds === IDLE_LIMIT){ alert("You've been inactive for a while. Want a short focus session or a break?"); } }, 1000);
document.addEventListener('visibilitychange', ()=>{ if(document.hidden){ document.title = "Come back ‚Äî LearnWithAI"; } else { document.title = "LearnWithAI ‚Äî Student Companion"; resetIdle(); } });

/* ----------------- Mood Suggestion controller ----------------- */
function showMoodSuggestion(){
  const mood = document.getElementById('emotionSelect').value;
  const box = document.getElementById('emotionOutput');
  let msg = "";
  switch(mood){
    case "stressed":
      msg = "üîµ You seem stressed.\n‚Ä¢ Try 2-min deep breathing. ‚Ä¢ Calm music. ‚Ä¢ Tip: Break tasks into small chunks.";
      break;
    case "sad":
      msg = "üü£ Feeling low? ‚Ä¢ Try mood-boosting playlist ‚Ä¢ Write one thing you're grateful for.";
      break;
    case "angry":
      msg = "üî¥ Feeling irritated? ‚Ä¢ Short walk ‚Ä¢ Anger-release breathing ‚Ä¢ Calm instrumental music.";
      break;
    case "confused":
      msg = "üü° Confused? ‚Ä¢ Write your doubt in one sentence ‚Ä¢ Ask Buddy to simplify it step-by-step.";
      break;
    case "overthinking":
      msg = "üü† Overthinking? ‚Ä¢ Grounding exercise ‚Ä¢ List top 3 tasks ‚Ä¢ Short break.";
      break;
    case "bored":
      msg = "üü¢ Bored? ‚Ä¢ Try an energetic playlist ‚Ä¢ Mini-challenge ‚Ä¢ Switch topic briefly.";
      break;
    default:
      msg = "Select a mood to get suggestions.";
  }
  box.innerHTML = msg.replace(/\n/g,'<br>');
}

/* ----------------- Small init to ensure UI ready ----------------- */
window.addEventListener('DOMContentLoaded', ()=> {
  // show home grid by default
  showHome();
  // ensure WD and Adaptive quiz ready
  renderWd();
  startAdaptiveQuiz();
  renderTasks();
  renderNotes();
});
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
      const name = localStorage.getItem("studentName");
      const college = localStorage.getItem("studentCollege");
      const branch = localStorage.getItem("studentBranch");
      const email = localStorage.getItem("studentEmail");
  
      if (!name) {
          window.location.href = "login.html";
      }
  
      document.getElementById("userName").innerText = name;
      document.getElementById("userCollege").innerText = college;
      document.getElementById("userBranch").innerText = branch;
      document.getElementById("userEmail").innerText = email;
  });
  </script>
</body>
</html>